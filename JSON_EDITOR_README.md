# JSON编辑器模块文档

## 📖 概述

JSON编辑器是一个完全封装的独立模块，提供专业的JSON数据查看和编辑功能，采用VSCode风格的深色主题设计。

## ✨ 功能特性

### 🎨 视觉设计
- **VSCode风格深色主题**：专业的代码编辑器外观
- **语法高亮**：不同数据类型使用不同颜色显示
- **清晰的层级结构**：缩进线条和图标指示

### 🔧 交互功能
- **节点展开/收缩**：点击箭头图标控制显示/隐藏
- **全局展开/收缩**：一键展开或收缩所有节点
- **实时搜索**：高亮搜索结果并自动展开相关节点
- **一键复制**：复制完整JSON内容到剪贴板

### 📊 信息显示
- **状态栏**：显示数据类型、字符数、行数统计
- **节点计数**：显示对象属性数量或数组元素数量
- **错误提示**：JSON格式错误时的友好提示

## 🏗️ 架构设计

### 模块化封装
```javascript
const JsonEditor = {
    // 所有功能都封装在这个对象中
    render: function(container, content) { ... },
    expandAll: function(button) { ... },
    // ... 其他方法
};
```

### 样式隔离
所有CSS样式都使用严格的选择器和`!important`标记来确保隔离：

```css
/* 高优先级选择器 */
.compare-content-area .json-editor,
.compare-panel-content .json-editor {
    /* 样式定义 */
}

/* 所有子元素都有明确的命名空间 */
.json-editor .json-toolbar { ... }
.json-editor .json-content { ... }
```

## 🛡️ 样式隔离方案

### 1. 命名空间隔离
- 所有CSS类名都以`.json-editor`开头
- 使用具体的选择器链，避免样式冲突
- JavaScript函数都封装在`JsonEditor`对象中

### 2. 优先级保护
- 关键样式使用`!important`标记
- 使用多层选择器提高CSS特异性
- 重置所有子元素的默认样式

### 3. 功能独立性
- 独立的事件处理系统
- 独立的状态管理
- 独立的配置选项

## 📁 文件结构

### CSS样式文件
位置：`static/style.css`
区域：`/* JSON编辑器完全隔离样式模块 */` 开始的部分

### JavaScript模块
位置：`templates/index.html`
区域：`JsonEditor`对象定义部分

## 🔧 使用方法

### 基本用法
```javascript
// 渲染JSON到容器
JsonEditor.render(container, jsonString);

// 从缓存渲染
JsonEditor.renderFromCache(container, filePath);
```

### 高级配置
```javascript
// 修改配置选项
JsonEditor.config.maxCacheSize = 100 * 1024 * 1024; // 100MB
JsonEditor.config.cacheExpireTime = 60 * 60 * 1000; // 1小时
```

## ⚠️ 维护注意事项

### 样式修改
1. **只修改JSON编辑器相关样式**：确保所有修改都在JSON编辑器样式区域内
2. **保持选择器特异性**：不要移除`.json-editor`前缀
3. **使用!important保护**：关键样式要使用`!important`

### 功能扩展
1. **在JsonEditor对象内添加新方法**
2. **保持命名约定**：使用清晰的方法名
3. **更新文档**：在此文件中记录新功能

### 避免冲突
1. **不要在全局作用域添加JSON相关函数**
2. **不要修改其他组件的样式**
3. **使用独立的事件处理器**

## 🎨 颜色方案

### 语法高亮颜色
- **键名**: `#9cdcfe` (浅蓝色)
- **字符串**: `#ce9178` (橙色)
- **数字**: `#b5cea8` (绿色)
- **布尔值/null**: `#569cd6` (蓝色)
- **括号**: `#d7ba7d` (金色)
- **背景**: `#1e1e1e` (深色)

### UI元素颜色
- **工具栏**: `#2d2d30`
- **按钮**: `#0e639c`
- **搜索框**: `#3c3c3c`
- **状态栏**: `#252526`

## 🚀 性能优化

### 缓存机制
- 50MB缓存限制
- 30分钟自动过期
- 智能预加载小文件

### 渲染优化
- 虚拟滚动支持
- 惰性节点展开
- 硬件加速动画

## 🐛 故障排除

### 常见问题
1. **样式被覆盖**：检查是否有其他CSS影响
2. **功能不工作**：检查JavaScript控制台错误
3. **性能问题**：检查JSON文件大小和缓存使用

### 调试方法
```javascript
// 开启调试模式
JsonEditor.debug = true;

// 查看缓存状态
console.log(JsonEditor.cache);

// 查看配置
console.log(JsonEditor.config);
```

## 📝 更新日志

### v2.0 (当前版本)
- ✅ 完全模块化封装
- ✅ 样式隔离保护
- ✅ 性能优化
- ✅ 错误处理改进

### v1.0
- ✅ 基础功能实现
- ✅ VSCode风格主题
- ✅ 展开收缩功能

## 🤝 贡献指南

1. 修改前先阅读此文档
2. 保持代码风格一致
3. 测试所有功能
4. 更新相关文档
5. 确保向后兼容性

---

**重要提醒**：此模块已完全封装，不会被其他样式或功能影响。如需修改，请严格按照上述指南操作。 